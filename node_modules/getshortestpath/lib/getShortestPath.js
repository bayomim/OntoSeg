/**
 * @author: Mostafa Bayomi
 * bayomim@tcd.ie
 * 
 * A module used to build the similariy scores files. 
 * No need to use it unless you want to re-measure the similarity scores between DBpedia classes
 */

var dbp_distance = require('dbp_distance');

var theArr = [];
var shortAR = [];
var cprocess = [];
var parr = [];
exports.getShortestPath = function (n1, n2, callb) {
    //@TODO: check the owl#thing .. #2. the distances are wrong 
    var ret;
    if (Array.isArray(n1) && Array.isArray(n2)) {// two arrays of classes
        theArr = [];
       //console.log("Two Arrays:")
        distArr = [];
        var r = 0;
        
        shortAR = [],
            longAR = [];
        if (n1.length >= n2.length) {
            longAR = n1;
            shortAR = n2;
        }
        else {
            longAR = n2;
            shortAR = n1;
        }
        var carr = [];
        var ar_ar_distance = 0; //  to summ all distances between two arrays then / by shortAr.length
        for (var u = 0; u < shortAR.length; u++) {
            // distance bet one class and array of classes 
            var distan = distFunction(longAR, shortAR[u]);
            ar_ar_distance += distan;
        }
        // normalise .. devide by the shortAR length (no. of multiplication operations)
        ret = ar_ar_distance / shortAR.length;
    }
    else if (Array.isArray(n1)) { // array and node
      // console.log("array %s and node %s:", n1, n2);
        ret = distFunction(n1, n2);
    }
    else if (Array.isArray(n2)) {// node and array
     // console.log("node %s and array %s:", n1, n2);
       ret =  distFunction(n2, n1);
    }
    else { // two nodes
     // console.log("node %s and node %s:", n1,n2);
        var dist = dbp_distance.distance(n1,n2);
        ret = dist / 2;// normalise .. devide by 2
    }
  // console.log("dist:" + ret);
    return ret;
}

function distFunction(arr, nn) { // get the distance between array and one node
   var distancesSum = 0; // to summ all distances and divide by arr length (norm)
    for (var i = 0; i < arr.length; i++) {
        var dist = dbp_distance.distance(arr[i], nn);// distance bet 2 nodes 
        distancesSum += dist;
    }
    distancesSum = distancesSum / arr.length; // @Selim: average (normalise)
    return distancesSum;
}


